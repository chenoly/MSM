<div align="center">
<h1>Mixed-Bit Sampling Watermarking: Unifying Stochastic Anti-Counterfeiting and Authentication in Copy Sensitive Graphical Codes</h1>

Jiale Chen<sup>1,3</sup>, Li Dong<sup>1</sup>, and Wei Wang<sup>2,3</sup>, Weiwei Sun<sup>4</sup>, Yushu Zhang<sup>5</sup>, Jiantao Zhou<sup>6</sup>

<sup>1</sup>Ningbo University,
<sup>2</sup>Shenzhen MSU-BIT University,
<sup>3</sup>Beijing Institute of Technology,
<sup>4</sup>Alibaba Group,
<sup>5</sup>Jiangxi University of Finance and Economics,
<sup>6</sup>University of Macau
</div>

# Introduction
1. This is the official implementation of the paper titled *"Mixed-Bit Sampling Watermarking: Unifying Stochastic Anti-Counterfeiting and Authentication in Copy Sensitive Graphical Codes."*
2. The work is based on our preliminary research [MSG](https://ieeexplore.ieee.org/document/10376267), and more details of the preliminary work can be found at [GitHub Repository](https://github.com/chenoly/MSG).
3. The dataset used in this work is publicly available at [Kaggle](https://www.kaggle.com/datasets/chenoly/msw-dataset).

## Overview
The problem of counterfeiting poses serious consequences. Copy Sensitive Graphical Codes (CSGC) refers to a generic type of image pattern that is highly sensitive to physical illegal copying, and Copy Detection Patterns (CDP) and Two-Level QR Codes (2LQR code) are the two representative solutions. However, CDP implements the anti-copying by generating random noise, but it cannot convey any watermarks for authentication. In contrast, 2LQR code provides watermarking function by modulating pre-defined deterministic texture patterns, but it lacks stochasticity to resist illegal copying.

In this work, we propose a unified optimization framework, which enjoys the stochastic anti-counterfeiting of CDP and the watermarking functionality of 2LQR code. Specifically, we treat CDP as random noise image that is composed of multiple texture patterns like the texture pattern in 2LQR code, each pattern representing one bit. To this end, both CDP and 2LQR codes can be obtained by designing how to generate the texture patterns.

We formulate the generation of texture patterns into a constrained optimization framework termed Mixed-Bit Sampling Watermark (MSW) for texture pattern generation. The objective function consists of the white pixel ratio and spatial randomness of texture patterns, and the constraints are the watermark embedding function which can be flexibly selected by users (e.g., DCT watermark or Pearson similarity). A two-step sampling algorithm is proposed to solve this optimization problem.

We demonstrate two concrete examples of the MSW framework and compare them with the conventional CDP and 2LQR code. Experimental results demonstrate that the texture patterns generated by the proposed MSW method can effectively address issues in both CDP and 2LQR code.
## Supplementary experimental results

![](all_result_1.png)
![](all_result_2.png)

## Requirements
- Python
- bchlib==0.14.0
- opencv-python==3.4.2.16
- numpy
- scikit-image
- scipy
- hashlib
- pytorch
